#!/bin/bash
whois $1 | awk -F': ' '(/^Registrant |^Admin |^Tech /){gsub(/^ +| +$/,"",$2);if($1 ~ /Street$/){$2=$2" "};if($1 ~ / Ext$/){sub(/ Ext$/," Ext:",$1)};data[$1]=$2} END{sect[1]="Registrant";sect[2]="Admin";sect[3]="Tech";fields[1]="Name";fields[2]="Organization";fields[3]="Street";fields[4]="City";fields[5]="State/Province";fields[6]="Postal Code";fields[7]="Country";fields[8]="Phone";fields[9]="Phone Ext:";fields[10]="Fax";fields[11]="Fax Ext:";fields[12]="Email";for(s=1;s<=3;s++){for(i=1;i<=12;i++){k=sect[s]" "fields[i];print k","(data[k] ? data[k] : "")}}}' > "$1.csv"
